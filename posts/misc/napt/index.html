<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>How does Router know where to forward packet</title>
<meta name=description content="A small brief on NAPT which answers a question I have always had while studting Computer Networks"><meta name=keywords content='blog,datDhruv,datdhruv,typdef,computer networks'><meta property="og:url" content="https://dhruv.ing/posts/misc/napt/"><meta property="og:type" content="website"><meta property="og:title" content="How does Router know where to forward packet"><meta property="og:description" content="A small brief on NAPT which answers a question I have always had while studting Computer Networks"><meta property="og:image" content="https://dhruv.ing/"><meta property="og:image:secure_url" content="https://dhruv.ing/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="How does Router know where to forward packet"><meta name=twitter:description content="A small brief on NAPT which answers a question I have always had while studting Computer Networks"><meta property="twitter:domain" content="https://dhruv.ing/posts/misc/napt/"><meta property="twitter:url" content="https://dhruv.ing/posts/misc/napt/"><meta name=twitter:image content="https://dhruv.ing/"><link rel=canonical href=https://dhruv.ing/posts/misc/napt/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.224c8e70fed292d18d7d9ae1b36797c99144e0be1117e2ea2c428379c8496551.js integrity="sha256-IkyOcP7SktGNfZrhs2eXyZFE4L4RF+LqLEKDechJZVE="></script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=nav-title><a class=nav-brand href=https://dhruv.ing/>Dhruv's Blog</a></div><div class=nav-links><div class=nav-link><a href=https://dhruv.ing/posts/><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://dhruv.ing/tags/><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/datdhruv target=_blank><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://dhruv.ing/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://dhruv.ing/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/datdhruv target=_blank><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>How does Router know where to forward packet</h1><small role=doc-subtitle>A small brief on NAPT which answers a question I have always had while studting Computer Networks</small><p class=post-date>August 17, 2023</p><ul class=post-tags><li class=post-tag><a href=https://dhruv.ing/tags/computer-networks>computer networks</a></li></ul></div><div class=post-content><p><h3 id=mirror-copyhttpssuperusercomquestions105838how-does-router-know-where-to-forward-packet><a href=https://superuser.com/questions/105838/how-does-router-know-where-to-forward-packet>(mirror copy)</a></h3><h2 id=the-question>The question</h2><p>If several computers with local addresses (192.168.0.#) are connected to a router and each computer opens a web browser and requests a page over HTTP, when these TCP:80 packets are sent out, the router switches the local address with the static IP of the router (i.e. Provider given IP) so the server can reply to the appropriate address.</p><p>But how does the router know to which computer to forward the HTTP reply, since the TCP header does not contain the local IP address (does it?), and all computers are using port 80?</p><p>Does this have anything to do with the MAC addresses?</p><p>How exactly does this work?</p><h2 id=the-answer>The answer</h2><p>Most home routers use a special-case of NAT called PAT.</p><p>You&rsquo;ll also see it referred to as NAPT, or IP Masquerading. All three of the latter terms mean the same thing in general use. (The acronyms - Network Address Translation / Port Address Translation / Network Address Port Translation)</p><p>When the packet goes out from your internal machine, the source address is rewritten as you are aware. The source port is also changed, usually to a high number, and the router keeps an address translation table.</p><p>For example, let&rsquo;s say you have a client machine that goes to <a href=https://www.google.com>www.google.com</a>. Your computer (e.g., 192.168.1.100) looks that address up and makes a TCP connection to 72.14.204.147 on port 80 from your internal IP address, using a random source port.</p><p>To your computer, the connection looks like this:</p><p><code>192.168.1.100:37641 &lt;--> 72.14.204.147:80</code></p><p>Your computer sends the packet to the router, which picks a new random high port and rewrites the packet. Each outbound connection gets its own port on the router. The router then forwards the packet on to your ISP after adding it to its connection table:</p><pre tabindex=0><code>PrivateIP        PrivatePort   PublicIP      PublicPort    Remote          RemotePort
-------------    ----------    -----------   -----------   ----------      -----------
192.168.1.100    37641         *10.6.23.5    59273         72.14.204.147   80
</code></pre><p>*For example purposes, I used an address starting with 10, but these aren&rsquo;t publicly routable. The table is also somewhat oversimplified.</p><p>To google, the connection looks like this:</p><p><code>10.6.23.5:59273 &lt;--> 72.14.204.147:80</code></p><p>Google will send it&rsquo;s reponse to <code>10.6.23.5</code> on port <code>59273</code>. Your router then looks up that information in the table and forwards the packet on to <code>192.168.1.100:37641</code>.</p></p></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="topFunction()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function topFunction(){smoothScrollToTop()}function smoothScrollToTop(){const e=()=>{const t=document.documentElement.scrollTop||document.body.scrollTop;t>0&&(window.requestAnimationFrame(e),window.scrollTo(0,t-t/8))};e()}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#mirror-copyhttpssuperusercomquestions105838how-does-router-know-where-to-forward-packet><a href=https://superuser.com/questions/105838/how-does-router-know-where-to-forward-packet>(mirror copy)</a></a></li></ul></li><li><a href=#the-question>The question</a></li><li><a href=#the-answer>The answer</a></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 datDhruv</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>